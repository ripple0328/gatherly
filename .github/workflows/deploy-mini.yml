name: Deploy (mini)

on:
  push:
    branches: [main]
  workflow_dispatch:

concurrency:
  group: deploy-mini
  cancel-in-progress: false

jobs:
  deploy:
    name: Deploy to mini (self-hosted)
    runs-on: [self-hosted, gatherly]

    timeout-minutes: 30

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Deploy
        shell: bash
        env:
          # NOTE: do not use "~" here; GitHub Actions does not expand it.
          # Let deploy-mini.sh default these using $HOME.
          LAUNCHD_LABEL: com.gatherly
        run: |
          bash scripts/deploy-mini.sh
